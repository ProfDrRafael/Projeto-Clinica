/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JPanel.java to edit this template
 */
package Visao.Telas;

import VO.AdministradorVO;
import VO.EstagiarioVO;
import VO.OrientadorVO;
import VO.SecretariaVO;
import VO.UsuarioVO;
import Regradenegocio.UsuarioRN;
import Visao.Components.SimpleForm;
import Visao.Utils.MessagesAlert;
import Visao.Utils.RedimencionarIcones;
import java.awt.HeadlessException;
import java.time.LocalDate;

/**
 *
 * @author john
 */
public class FormUsuario extends SimpleForm {

    /**
     * Creates new form cadastroUsuario
     */
    public FormUsuario() {
        initComponents();
        // redimensionarIcones();

        RedimencionarIcones redimencionarIcone = new RedimencionarIcones();
        redimencionarIcone.redimensionarIcones(btSalvar, "/Multimidia/imagens/approved-icon.png");
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        pCentro = new javax.swing.JPanel();
        tfNome = new javax.swing.JTextField();
        lbNome = new javax.swing.JLabel();
        tfEmail = new javax.swing.JTextField();
        lbEmail = new javax.swing.JLabel();
        cbFuncao = new javax.swing.JComboBox<>();
        lbFuncao = new javax.swing.JLabel();
        pfSenha = new javax.swing.JPasswordField();
        lbSenha = new javax.swing.JLabel();
        btSalvar = new javax.swing.JButton();
        pfConfirmarSenha = new javax.swing.JPasswordField();
        lbConfirmarSenha = new javax.swing.JLabel();
        jSeparator1 = new javax.swing.JSeparator();
        pNorth = new javax.swing.JPanel();
        lbClinica = new javax.swing.JLabel();
        lbProntuario = new javax.swing.JLabel();

        setMaximumSize(new java.awt.Dimension(990, 480));
        setMinimumSize(new java.awt.Dimension(990, 480));
        setPreferredSize(new java.awt.Dimension(990, 480));
        setLayout(new java.awt.BorderLayout());

        pCentro.setBackground(java.awt.SystemColor.controlHighlight);
        pCentro.setPreferredSize(new java.awt.Dimension(1024, 768));

        tfNome.setFont(new java.awt.Font("Segoe UI", 0, 24)); // NOI18N

        lbNome.setFont(new java.awt.Font("Segoe UI", 0, 24)); // NOI18N
        lbNome.setForeground(new java.awt.Color(0, 102, 102));
        lbNome.setText("*Nome:");

        tfEmail.setFont(new java.awt.Font("Segoe UI", 0, 24)); // NOI18N

        lbEmail.setFont(new java.awt.Font("Segoe UI", 0, 24)); // NOI18N
        lbEmail.setForeground(new java.awt.Color(0, 102, 102));
        lbEmail.setText("*Email:");

        cbFuncao.setFont(new java.awt.Font("Segoe UI", 0, 24)); // NOI18N
        cbFuncao.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Orientador", "Estagiário", "Secretária", "Pesquisador" }));

        lbFuncao.setFont(new java.awt.Font("Segoe UI", 0, 24)); // NOI18N
        lbFuncao.setForeground(new java.awt.Color(0, 102, 102));
        lbFuncao.setText("*Função:");

        pfSenha.setFont(new java.awt.Font("Segoe UI", 0, 24)); // NOI18N
        pfSenha.setText("jPasswordField1");

        lbSenha.setFont(new java.awt.Font("Segoe UI", 0, 24)); // NOI18N
        lbSenha.setForeground(new java.awt.Color(0, 102, 102));
        lbSenha.setText("*Senha:");

        btSalvar.setBackground(new java.awt.Color(102, 255, 102));
        btSalvar.setFont(new java.awt.Font("Segoe UI", 0, 24)); // NOI18N
        btSalvar.setForeground(new java.awt.Color(51, 51, 51));
        btSalvar.setText("Salvar");
        btSalvar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btSalvarActionPerformed(evt);
            }
        });

        pfConfirmarSenha.setFont(new java.awt.Font("Segoe UI", 0, 24)); // NOI18N
        pfConfirmarSenha.setText("jPasswordField1");

        lbConfirmarSenha.setFont(new java.awt.Font("Segoe UI", 0, 24)); // NOI18N
        lbConfirmarSenha.setForeground(new java.awt.Color(0, 102, 102));
        lbConfirmarSenha.setText("*Confirmar senha:");

        javax.swing.GroupLayout pCentroLayout = new javax.swing.GroupLayout(pCentro);
        pCentro.setLayout(pCentroLayout);
        pCentroLayout.setHorizontalGroup(
            pCentroLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jSeparator1, javax.swing.GroupLayout.Alignment.TRAILING)
            .addGroup(pCentroLayout.createSequentialGroup()
                .addGap(19, 19, 19)
                .addGroup(pCentroLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addGroup(pCentroLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addComponent(lbSenha)
                        .addComponent(lbNome))
                    .addComponent(lbEmail))
                .addGap(12, 12, 12)
                .addGroup(pCentroLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addGroup(pCentroLayout.createSequentialGroup()
                        .addComponent(pfSenha, javax.swing.GroupLayout.PREFERRED_SIZE, 303, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(18, 18, 18)
                        .addComponent(lbConfirmarSenha)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(pfConfirmarSenha, javax.swing.GroupLayout.PREFERRED_SIZE, 299, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(pCentroLayout.createSequentialGroup()
                        .addGroup(pCentroLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                            .addComponent(tfEmail, javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(pCentroLayout.createSequentialGroup()
                                .addComponent(tfNome, javax.swing.GroupLayout.PREFERRED_SIZE, 407, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addGap(18, 18, 18)
                                .addComponent(lbFuncao)))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(cbFuncao, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)))
                .addGap(0, 55, Short.MAX_VALUE))
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, pCentroLayout.createSequentialGroup()
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(btSalvar)
                .addGap(52, 52, 52))
        );
        pCentroLayout.setVerticalGroup(
            pCentroLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pCentroLayout.createSequentialGroup()
                .addGap(18, 18, 18)
                .addGroup(pCentroLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lbNome)
                    .addComponent(tfNome, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(lbFuncao)
                    .addComponent(cbFuncao, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(20, 20, 20)
                .addGroup(pCentroLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lbEmail)
                    .addComponent(tfEmail, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(23, 23, 23)
                .addGroup(pCentroLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lbConfirmarSenha)
                    .addComponent(pfConfirmarSenha, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(pfSenha, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(lbSenha))
                .addGap(18, 18, 18)
                .addComponent(jSeparator1, javax.swing.GroupLayout.PREFERRED_SIZE, 10, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addComponent(btSalvar)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        add(pCentro, java.awt.BorderLayout.CENTER);

        pNorth.setBackground(new java.awt.Color(0, 102, 102));
        pNorth.setPreferredSize(new java.awt.Dimension(638, 183));

        lbClinica.setFont(new java.awt.Font("Tahoma", 0, 10)); // NOI18N
        lbClinica.setForeground(new java.awt.Color(255, 255, 255));
        lbClinica.setText("Clínica de Psicologia");

        lbProntuario.setFont(new java.awt.Font("Verdana", 1, 24)); // NOI18N
        lbProntuario.setForeground(new java.awt.Color(255, 255, 255));
        lbProntuario.setText("Cadastro de Usuário");

        javax.swing.GroupLayout pNorthLayout = new javax.swing.GroupLayout(pNorth);
        pNorth.setLayout(pNorthLayout);
        pNorthLayout.setHorizontalGroup(
            pNorthLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pNorthLayout.createSequentialGroup()
                .addContainerGap(133, Short.MAX_VALUE)
                .addGroup(pNorthLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(lbClinica)
                    .addComponent(lbProntuario))
                .addGap(0, 586, Short.MAX_VALUE))
        );
        pNorthLayout.setVerticalGroup(
            pNorthLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pNorthLayout.createSequentialGroup()
                .addGap(0, 72, Short.MAX_VALUE)
                .addComponent(lbProntuario)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(lbClinica)
                .addGap(0, 63, Short.MAX_VALUE))
        );

        add(pNorth, java.awt.BorderLayout.NORTH);
    }// </editor-fold>//GEN-END:initComponents

    private void btSalvarActionPerformed(java.awt.event.ActionEvent evt) {// GEN-FIRST:event_btSalvarActionPerformed
        UsuarioRN usuarioRN = new UsuarioRN();
        MessagesAlert messagesAlert = new MessagesAlert();

        try {
            // Obter a função selecionada no ComboBox
            String funcaoSelecionada = cbFuncao.getSelectedItem().toString();

            // Inicializar o VO apropriado com base na função selecionada
            UsuarioVO usuarioVO;
            String nome = tfNome.getText();
            String email = tfEmail.getText();
            String senha = new String(pfSenha.getPassword());

            switch (funcaoSelecionada) {
                case "Administrador" -> {
                    usuarioVO = new AdministradorVO(0, nome, email, senha);
                }
                case "Estagiário" -> {
                    Integer ano = LocalDate.now().getYear();
                    ;
                    usuarioVO = new EstagiarioVO(0, nome, email, senha, ano);
                }
                case "Orientador" -> {
                    usuarioVO = new OrientadorVO(0, nome, email, senha);
                }
                case "Secretária" -> {
                    usuarioVO = new SecretariaVO(0, nome, email, senha);
                }
                default -> {
                    messagesAlert.showErrorMessage("Função inválida selecionada.");
                    return;
                }
            }

            // Validar se a senha e a confirmação coincidem
            String confirmacaoSenha = new String(pfConfirmarSenha.getPassword());
            if (!usuarioVO.getSenha().equals(confirmacaoSenha)) {
                messagesAlert.showErrorMessage("A senha e a confirmação de senha não coincidem.");
                return;
            }

            // salvar o usuário
            if (usuarioRN.salvarUsuario(usuarioVO)) {
                messagesAlert.showSuccessMessage("Usuário salvo com sucesso!");
            } else {
                messagesAlert.showErrorMessage("Erro ao salvar o usuário.");
            }
        } catch (HeadlessException | NumberFormatException e) {
            messagesAlert.showErrorMessage("Erro: " + e.getMessage());
        }
    }// GEN-LAST:event_btSalvarActionPerformed

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btSalvar;
    private javax.swing.JComboBox<String> cbFuncao;
    private javax.swing.JSeparator jSeparator1;
    private javax.swing.JLabel lbClinica;
    private javax.swing.JLabel lbConfirmarSenha;
    private javax.swing.JLabel lbEmail;
    private javax.swing.JLabel lbFuncao;
    private javax.swing.JLabel lbNome;
    private javax.swing.JLabel lbProntuario;
    private javax.swing.JLabel lbSenha;
    private javax.swing.JPanel pCentro;
    private javax.swing.JPanel pNorth;
    private javax.swing.JPasswordField pfConfirmarSenha;
    private javax.swing.JPasswordField pfSenha;
    private javax.swing.JTextField tfEmail;
    private javax.swing.JTextField tfNome;
    // End of variables declaration//GEN-END:variables

}
